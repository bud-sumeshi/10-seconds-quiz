<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>10ç§’å½“ã¦ã‚¯ã‚¤ã‚º</title>
<style>
  body {
    text-align: center;
  margin-top: clamp(20px, 6vh, 60px);
  padding: 0 10px;
  }

  #auth {
  margin-top: 80px;
}

  #time {
    font-size: clamp(40px, 14vw, 72px);
    margin: 30px;
    transition: opacity 0.3s, transform 0.3s;
  }
  .hidden { opacity: 0; }
  .big { transform: scale(1.5); }

  button {
  font-size: 20px;
  padding: 14px 22px;
  touch-action: manipulation;
}

  #ranking {
  margin-top: 30px;
  display: inline-block;
  text-align: left;
}

#ranking ol {
  padding-left: 0;
  list-style: none;
}

.perfect-time {
  color: gold;
  transform: scale(1.7);
}

#perfect {
  font-size: 36px;
  color: gold;
  margin-top: 20px;
  animation: pop 0.6s ease-out;
}

#perfectCount{
  color: red;
  font-weight: bold;
}

@keyframes pop {
  0% { transform: scale(0.5); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}
</style>
</head>


<body>

<div id="auth">
  <h2>ğŸ”’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
  <input type="password" id="pw">
  <br><br>
  <button onclick="checkPw()">å…¥ã‚‹</button>
  <p id="pwError" style="color:red; display:none;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™</p>
</div>

<div id="app" style="display:none;">
<h1>10ç§’å½“ã¦ã‚¯ã‚¤ã‚º</h1>

<div id="time">0.00</div>
<div id="perfect" style="display:none;">ğŸ‰ PERFECT!! ğŸ‰</div>

<button id="startBtn">START</button>
<button id="stopBtn" disabled>STOP</button>

<p id="result"></p>
<p id="perfectCount">PERFECTå›æ•°ï¼š0</p>

<div id="ranking">
  <h2>ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
  <ol id="rankingList"></ol>
</div>


<script>
let startTime = 0;
let timerId = null;
let hideTimerId = null;

const timeDiv = document.getElementById("time");
const resultP = document.getElementById("result");
const rankingList = document.getElementById("rankingList");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const perfectDiv = document.getElementById("perfect");

const STORAGE_KEY = "ten_sec_ranking";
const PERFECT_KEY = "ten_sec_perfect_count";

// ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—
function loadRanking() {
  const data = localStorage.getItem(STORAGE_KEY);
  return data ? JSON.parse(data) : [];
}

// ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¿å­˜
function saveRanking(ranking) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(ranking));
}

// ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
function showRanking() {
  const ranking = loadRanking();
  rankingList.innerHTML = "";

  ranking.forEach((r, i) => {
    const li = document.createElement("li");
    li.textContent =
      `${i + 1}ä½ï¼š${r.time.toFixed(2)} ç§’ï¼ˆå·® ${r.diff.toFixed(2)}ï¼‰`;
    rankingList.appendChild(li);
  });
}

//perfectå›æ•°å–å¾—ã€€ä¿å­˜ã€€è¡¨ç¤º
function loadPerfectCount() {
  const count = localStorage.getItem(PERFECT_KEY);
  return count ? parseInt(count) : 0;
}

function savePerfectCount(count) {
  localStorage.setItem(PERFECT_KEY, count);
}

function showPerfectCount() {
  const count = loadPerfectCount();
  document.getElementById("perfectCount").textContent =
    `PERFECTå›æ•°ï¼š${count}`;
}

// START
function onStart() {
  startTime = performance.now();
  resultP.textContent = "";
  timeDiv.textContent = "0.00";
  timeDiv.classList.remove("hidden", "big", "perfect-time");
  perfectDiv.style.display = "none";

  startBtn.disabled = true;
  stopBtn.disabled = false;

  timerId = setInterval(() => {
    const now = performance.now();
    const elapsed = (now - startTime) / 1000;
    timeDiv.textContent = elapsed.toFixed(2);
  }, 10);

  hideTimerId = setTimeout(() => {
    timeDiv.classList.add("hidden");
  }, 3000);
}

// stop
function onStop() {
  clearInterval(timerId);
  clearTimeout(hideTimerId);

  startBtn.disabled = false;
  stopBtn.disabled = true;

  timeDiv.classList.remove("hidden");
  timeDiv.classList.add("big");

  const finalTime = parseFloat(timeDiv.textContent);
  const diff = Math.abs(10 - finalTime);

  if (finalTime.toFixed(2) === "10.00") {
    timeDiv.classList.add("perfect-time");
    perfectDiv.style.display = "block";
    let count = loadPerfectCount();
    savePerfectCount(++count);
    showPerfectCount();
  } else {
    timeDiv.classList.remove("perfect-time");
    perfectDiv.style.display = "none";
  }

  let message = "";
  if (diff < 0.05) message = "ç¥ã™ãã‚‹";
  else if (diff < 0.20) message = "ã™ã”ã„";
  else if (diff < 0.50) message = "æƒœã—ã„";
  else message = "æ®‹å¿µ";

  resultP.textContent = `çµæœï¼š${finalTime.toFixed(2)} ç§’ï¼ˆ${message}ï¼‰`;

  // ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ›´æ–°
  let ranking = loadRanking();
  ranking.push({ time: finalTime, diff });
  ranking.sort((a, b) => a.diff - b.diff);
  ranking = ranking.slice(0, 5);
  saveRanking(ranking);
  showRanking();
}

//ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
startBtn.addEventListener("click", onStart);
stopBtn.addEventListener("click", onStop);

// åˆå›è¡¨ç¤º
showRanking();
showPerfectCount();
</script>

<script>
const HASH = "a3c481c378cca710acee9503202cb29af1882b89a7e69170735d78022c852333"; 

const inputField = document.getElementById("pw");
const error = document.getElementById("pwError");

/* Enterã‚­ãƒ¼å¯¾å¿œï¼ˆã‚¹ãƒãƒ›ã‚‚OKï¼‰ */
inputField.addEventListener("keydown", function (event) {
  if (event.key === "Enter") {
    checkPw();
  }
});

/* SHA-256ã§ãƒãƒƒã‚·ãƒ¥åŒ– */
async function sha256(str) {
  const buf = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(str)
  );
  return [...new Uint8Array(buf)]
    .map(b => b.toString(16).padStart(2, "0"))
    .join("");
}

/* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰åˆ¤å®š */
async function checkPw() {
  const input = inputField.value;
  const hashed = await sha256(input);

  if (hashed === HASH) {
    sessionStorage.setItem("auth", "ok");
    document.getElementById("auth").style.display = "none";
    document.getElementById("app").style.display = "block";
    error.style.display = "none";
  } else {
    error.style.display = "block";
  }
}

/* å†èª­ã¿è¾¼ã¿å¯¾ç­– */
window.onload = () => {
  if (sessionStorage.getItem("auth") === "ok") {
    document.getElementById("auth").style.display = "none";
    document.getElementById("app").style.display = "block";
  }
};
</script>


</body>
